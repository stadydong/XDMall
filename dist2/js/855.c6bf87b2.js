"use strict";(self["webpackChunkvue2_view"]=self["webpackChunkvue2_view"]||[]).push([[855],{4855:function(t,e,s){s.r(e),s.d(e,{default:function(){return g}});var c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cart px-40 bg-zinc-50 pb-10"},[t._m(0),0!=t.carList.length?e("div",{staticClass:"cart-info"},[e("table",{staticClass:"table-auto w-full"},[t._m(1),e("tbody",t._l(t.carList,(function(s,c){return e("tr",{key:s.id,staticClass:"border"},[e("td",{staticClass:"flex items-center pl-4"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectProduct,expression:"selectProduct"}],attrs:{type:"checkbox"},domProps:{value:s.id,checked:Array.isArray(t.selectProduct)?t._i(t.selectProduct,s.id)>-1:t.selectProduct},on:{change:[function(e){var c=t.selectProduct,a=e.target,r=!!a.checked;if(Array.isArray(c)){var i=s.id,l=t._i(c,i);a.checked?l<0&&(t.selectProduct=c.concat([i])):l>-1&&(t.selectProduct=c.slice(0,l).concat(c.slice(l+1)))}else t.selectProduct=r},function(e){return t.changeChecked(s.checked,s.id)}]}}),e("img",{staticClass:"w-20 h-20 mx-4 my-4",attrs:{src:s.product.productImageUrl,alt:s.product.title}}),e("span",[t._v(t._s(s.product.title))])]),e("td",[t._v(" "+t._s(s.product.price)+" ")]),e("td",[t._v(" "+t._s(s.num)+" ")]),e("td",[t._v(" "+t._s(s.num*s.product.price)+" ")]),e("td",[e("button",{on:{click:function(e){return t.checkout(s)}}},[t._v("删除")])])])})),0)]),e("div",{staticClass:"flex justify-between items-center py-4 border border-t-0"},[e("div",{staticClass:"left"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.allSelect,expression:"allSelect"}],staticClass:"ml-4",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.allSelect)?t._i(t.allSelect,null)>-1:t.allSelect},on:{click:t.allChecked,change:function(e){var s=t.allSelect,c=e.target,a=!!c.checked;if(Array.isArray(s)){var r=null,i=t._i(s,r);c.checked?i<0&&(t.allSelect=s.concat([r])):i>-1&&(t.allSelect=s.slice(0,i).concat(s.slice(i+1)))}else t.allSelect=a}}}),t._v(" 全选")]),e("div",{staticClass:"right flex items-center text-base"},[e("div",[t._v(" 已选择 "),e("span",{staticClass:"text-xl text-red-600"},[t._v(t._s(t.selectCount))]),t._v(" 件商品 ")]),e("div",{staticClass:"px-4 text-zinc-300"},[t._v("|")]),e("div",{},[t._v(" 应付总额："),e("span",{staticClass:"text-xl text-red-600"},[t._v("￥"+t._s(t.selectProductPrice))])]),e("button",{staticClass:"bg-blue-600 text-white px-6 py-3 rounded-lg mx-4",on:{click:t.payment}},[t._v("现在结算")])])])]):e("div",{staticClass:"py-4 flex items-center flex-col border border-t-0"},[e("img",{staticClass:"w-72",attrs:{src:s(1360)}}),e("div",{staticClass:"my-3"},[t._v("你的购物车空空如也")]),e("router-link",{attrs:{to:"/goods"}},[e("button",{staticClass:"px-4 py-2 bg-zinc-100 rounded border text-zinc-500"},[t._v("前往选购")])])],1),e("a-modal",{attrs:{title:"由于个人用户无法申请微信二维码支付，只能模拟测试",cancelText:"取消支付",okText:"支付成功"},on:{ok:t.handleOk,cancel:t.handleCancel},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("div",{staticClass:"text-center text-3xl text-green-400"},[t._v("微信扫码")]),e("img",{staticClass:"mx-auto",attrs:{src:t.codeImg}}),e("div",{staticClass:"text-center"},[t._v("扫完码后点击支付成功")])])],1)},a=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"content bg-zinc-50"},[e("h2",{staticClass:"text-2xl pl-4 py-4 bg-zinc-150 mb-0"},[t._v("购物清单")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"bg-zinc-400 h-10 border"},[e("th",[t._v("商品信息")]),e("th",[t._v("单价")]),e("th",[t._v("数量")]),e("th",[t._v("小计")]),e("th",[t._v("操作")])])])}],r=(s(7658),s(3822)),i=s(2619);const l=(t,e,s)=>i.Z.patch("car",{carId:t,id:e,checked:s}),o=(t,e)=>i.Z.get(`/pay/codeImg?carId=${t}&userId=${e}`),n=(t,e)=>i.Z.get(`/pay/fail?carId=${t}&userId=${e}`),d=t=>i.Z["delete"]("/car",{data:{ids:t}});var u=s(6857),h={data(){return{selectProduct:[],visible:!1,codeImg:""}},computed:{...(0,r.rn)({carList:t=>t.MainStore.carList}),...(0,r.Se)(["checkProduct"]),allSelect:{get(){return this.selectProduct.length===this.carList.length},set(t){return t}},selectCount(){return this.selectProduct.length},selectProductPrice(){let t=this.carList.reduce(((t,e)=>{let s=0;return e.checked&&(s=e.num*e.product.productDetail.salePrice),t+s}),0);return t}},methods:{async changeChecked(t,e){const s=JSON.parse(localStorage.getItem("userInfo")).car.id;t=t?0:1;const c=await l(s,[e],t);c.success&&this.$store.dispatch("GetCarList")},async allChecked(){const t=JSON.parse(localStorage.getItem("userInfo")).car.id;if(this.selectProduct.length<this.carList.length){let e=[];this.carList.map((t=>{e.push(t.id)}));const s=await l(t,e,1);s.success&&(this.selectProduct=e,this.$store.dispatch("GetCarList"))}else{const e=await l(t,this.selectProduct,0);e.success&&(this.selectProduct=[],this.$store.dispatch("GetCarList"))}},async checkout(t){const e=await d([t.id]);e.success?(this.$message.success(e.data.message),this.$store.dispatch("GetCarList")):(0,u.l)(e.data,this)},async payment(){this.visible=!this.visible;const t=JSON.parse(localStorage.getItem("userInfo")),e=t.car.id,s=t.id,c=await o(e,s);c.success?this.codeImg=c.data:(0,u.l)(deleteResult.data,this)},handleOk(){this.$store.dispatch("GetCarList"),this.visible=!1,this.$message.success("支付成功")},async handleCancel(){const t=JSON.parse(localStorage.getItem("userInfo")),e=t.car.id,s=t.id;await n(e,s);this.$message.error("已取消支付"),this.visible=!1,this.$store.dispatch("GetCarList")}},watch:{carList(){this.selectProduct=[],this.carList.forEach((t=>{t.checked&&this.selectProduct.push(t.id)}))}},created(){this.carList.forEach((t=>{t.checked&&this.selectProduct.push(t.id)}))},mounted(){}},v=h,p=s(1001),m=(0,p.Z)(v,c,a,!1,null,null,null),g=m.exports},6857:function(t,e,s){s.d(e,{l:function(){return c}});const c=(t,e)=>{const{status:s,message:c}=t;switch(console.log(t,e),s){case 400:const t=c.response.message;t.forEach((t=>{e.$message.error(t)}));break;case 401:e.$message.error(c.message);break;case 404:e.$message.error(c.message);break}}},1360:function(t,e,s){t.exports=s.p+"img/cart.9948d3e5.png"}}]);