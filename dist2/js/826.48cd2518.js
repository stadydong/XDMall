"use strict";(self["webpackChunkvue2_view"]=self["webpackChunkvue2_view"]||[]).push([[826],{3826:function(t,e,c){c.r(e),c.d(e,{default:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cart px-40 bg-zinc-50"},[t._m(0),e("table",{staticClass:"table-auto w-full"},[t._m(1),e("tbody",t._l(t.carList,(function(c,s){return e("tr",{key:c.id,staticClass:"border"},[e("td",{staticClass:"flex items-center pl-4"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectProduct,expression:"selectProduct"}],attrs:{type:"checkbox"},domProps:{value:c.id,checked:Array.isArray(t.selectProduct)?t._i(t.selectProduct,c.id)>-1:t.selectProduct},on:{change:[function(e){var s=t.selectProduct,a=e.target,i=!!a.checked;if(Array.isArray(s)){var r=c.id,l=t._i(s,r);a.checked?l<0&&(t.selectProduct=s.concat([r])):l>-1&&(t.selectProduct=s.slice(0,l).concat(s.slice(l+1)))}else t.selectProduct=i},function(e){return t.changeChecked(c.checked,c.id)}]}}),e("img",{staticClass:"w-20 h-20 mx-4 my-4",attrs:{src:c.product.productImageUrl,alt:c.product.title}}),e("span",[t._v(t._s(c.product.title))])]),e("td",[t._v(" "+t._s(c.product.price)+" ")]),e("td",[t._v(" "+t._s(c.num)+" ")]),e("td",[t._v(" "+t._s(c.num*c.product.price)+" ")]),e("td",[e("button",{on:{click:t.checkout}},[t._v("删除")])])])})),0)]),e("div",{staticClass:"flex justify-between items-center py-4 border border-t-0"},[e("div",{staticClass:"left"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.allSelect,expression:"allSelect"}],staticClass:"ml-4",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.allSelect)?t._i(t.allSelect,null)>-1:t.allSelect},on:{click:t.allChecked,change:function(e){var c=t.allSelect,s=e.target,a=!!s.checked;if(Array.isArray(c)){var i=null,r=t._i(c,i);s.checked?r<0&&(t.allSelect=c.concat([i])):r>-1&&(t.allSelect=c.slice(0,r).concat(c.slice(r+1)))}else t.allSelect=a}}}),t._v(" 全选")]),e("div",{staticClass:"right flex items-center text-base"},[e("div",[t._v("已选择 "),e("span",{staticClass:"text-xl text-red-600"},[t._v(t._s(t.selectCount))]),t._v(" 件商品")]),e("div",{staticClass:"px-4 text-zinc-300"},[t._v("|")]),e("div",{},[t._v("应付总额："),e("span",{staticClass:"text-xl text-red-600"},[t._v("￥"+t._s(t.selectProductPrice))])]),e("button",{staticClass:"bg-blue-600 text-white px-6 py-3 rounded-lg mx-4",on:{click:t.payment}},[t._v("现在结算")])])]),e("div",{staticClass:"h-10"}),e("a-modal",{attrs:{title:"由于个人用户无法申请微信二维码支付，只能模拟测试",cancelText:"取消支付",okText:"支付成功"},on:{ok:t.handleOk,cancel:t.handleCancel},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("div",{staticClass:"text-center text-3xl text-green-400"},[t._v("微信扫码")]),e("img",{staticClass:"mx-auto",attrs:{src:t.codeImg}}),e("div",{staticClass:"text-center"},[t._v("扫完码后点击支付成功")])])],1)},a=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"content bg-zinc-50"},[e("h2",{staticClass:"text-2xl pl-4 py-4 bg-zinc-150 mb-0"},[t._v("购物清单")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"bg-zinc-400 h-10 border"},[e("th",[t._v("商品信息")]),e("th",[t._v("单价")]),e("th",[t._v("数量")]),e("th",[t._v("小计")]),e("th",[t._v("操作")])])])}],i=(c(7658),c(3822)),r=c(2619);const l=(t,e,c)=>r.Z.patch("car",{carId:t,id:e,checked:c}),d=(t,e)=>r.Z.get(`/pay/codeImg?carId=${t}&userId=${e}`),o=(t,e)=>r.Z.get(`/pay/fail?carId=${t}&userId=${e}`);var n={data(){return{selectProduct:[],visible:!1,codeImg:""}},computed:{...(0,i.rn)({carList:t=>t.MainStore.carList}),...(0,i.Se)(["checkProduct"]),allSelect:{get(){return this.selectProduct.length===this.carList.length},set(t){return t}},selectCount(){return this.selectProduct.length},selectProductPrice(){let t=this.carList.reduce(((t,e)=>{let c=0;return e.checked&&(c=e.num*e.product.productDetail.salePrice),t+c}),0);return t}},methods:{async changeChecked(t,e){const c=JSON.parse(localStorage.getItem("userInfo")).car.id;t=t?0:1;const s=await l(c,[e],t);s.success&&this.$store.dispatch("GetCarList")},async allChecked(){const t=JSON.parse(localStorage.getItem("userInfo")).car.id;if(this.selectProduct.length<this.carList.length){let e=[];this.carList.map((t=>{e.push(t.id)}));const c=await l(t,e,1);c.success&&(this.selectProduct=e,this.$store.dispatch("GetCarList"))}else{const e=await l(t,this.selectProduct,0);e.success&&(this.selectProduct=[],this.$store.dispatch("GetCarList"))}},checkout(){},async payment(){this.visible=!this.visible;const t=JSON.parse(localStorage.getItem("userInfo")),e=t.car.id,c=t.id,s=await d(e,c);s.success&&(this.codeImg=s.data)},handleOk(){this.$store.dispatch("GetCarList"),this.visible=!1,this.$message.success("支付成功")},async handleCancel(){const t=JSON.parse(localStorage.getItem("userInfo")),e=t.car.id,c=t.id,s=await o(e,c);console.log(s),this.$message.error("已取消支付"),this.visible=!1,this.$store.dispatch("GetCarList")}},watch:{carList(){this.selectProduct=[],this.carList.forEach((t=>{t.checked&&this.selectProduct.push(t.id)}))}},created(){this.carList.forEach((t=>{t.checked&&this.selectProduct.push(t.id)}))},mounted(){}},u=n,h=c(1001),v=(0,h.Z)(u,s,a,!1,null,null,null),p=v.exports}}]);